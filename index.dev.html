<html ng-app = "loc">
	<head>
		<title>Chronicling America</title>

		<link rel="icon" href="favicon.ico" />
		<link rel="stylesheet" type="text/css" href="js/leaflet/leaflet.css" />
		<link rel="stylesheet" type="text/css" href="js/ngRangeSlider-master/example/css/Default.css" />
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="js/leaflet/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
        <link rel="stylesheet" href="js/leaflet/Leaflet.markercluster/dist/MarkerCluster.css" />
		<link rel="stylesheet" href="js/angular-horizontal-timeline-master/angular-horizontal-timeline.css">
		<link rel="stylesheet" href="bootstrap/Font-Awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="css/styles.css">

		<script type="text/javascript" src="js/lodash.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.0/angular.min.js"></script>
		<script type="text/javascript" src="js/leaflet/leaflet.js"></script>
		<script type="text/javascript" src="js/angular-leaflet-directive/dist/angular-leaflet-directive.js"></script>
		<script type="text/javascript" src="js/ngRangeSlider-master/dist/ng-range-slider.js"></script>
		<script type="text/javascript" src="js/map.js"></script>
		<script type="text/javascript" src="js/angular-horizontal-timeline-master/angular-horizontal-timeline.js"></script>
		<script type="text/javascript" src="js/moment.js"></script>
		<script type="text/javascript" src="js/moment-range/lib/moment-range.js"></script>
		<script type="text/javascript" src="js/bower-angular-sanitize/angular-sanitize.js"></script>

	</head>
	<body ng-controller="MapCtrl" ng-cloak>
	<!-- Header -->
	<header class="row">
		<div class="col-md-6">
			<h2 style="padding-top:0;margin-top:0;"><i class="fa fa-map-marker"></i> US News Map</h2>
		</div>
		<div class="col-md-6 text-right icons">
			<i class="fa fa-search" ng-class="{iconSelected: icons['search']}"></i>
			<i class="fa fa-play-circle-o" ng-class="{iconSelected: icons['play']}"></i>
			<i class="fa fa-history" ng-class="{iconSelected: icons['history']}"></i>
		</div>
	</header>

	<!-- Search -->
	<form ng-submit="newSearch()">
		<div class="row nav form-inline">
			<!-- Search Term -->
			<div class="col-md-2 col-md-offset-2">
				<div class="de-input">
					<label>Search Term</label>
					<input type="text" ng-model="search" />
				</div>
			</div>

			<!-- Start Date -->
			<div class="col-md-2">
					<div class="de-input">
						<label>Start Date</label>
						<input type="date" ng-model="startDate" min="1836-01-01" max="1925-01-01" />
					</div>
			</div>

			<!-- End Date -->
			<div class="col-md-2">
				<div class="de-input">
					<label>End Date</label>
					<input type="date" ng-model="endDate" min="1836-01-02" max="1925-01-02" />
				</div>
			</div>

			<div class="btn-group btn-group-sm col-md-2 text-center" data-toggle="buttons">
				<label class="btn btn-info" ng-class="{active:lit_or_fuzz=='Literal'}">
                	<input type="radio" name="searchType" ng-model="lit_or_fuzz" value="Literal" autocomplete="off" checked />
					Literal
				</label>
				<label class="btn btn-info" ng-class="{active:lit_or_fuzz=='Fuzzy'}">
                	<input type="radio" name="searchType" ng-model="lit_or_fuzz" value="Fuzzy" autocomplete="off" />
					Fuzzy
				</label>
			</div>
			<div class="col-md-2 text-right">
				<span ng-show="loadingStatus"><i class="fa fa-spinner fa-spin"></i></span>
				<input type="submit" id="submit" class="btn btn-default" value="Search" ng-disabled="loadingStatus" />
			</div>
		</div>
	</form>
	<div class="row">
		<div class="row" ng-show="!ack && 0">
			<div class="col-md-12">
				<br/>
				<div class="alert alert-warning">
					<h4>Maintenance Notice</h4>
					We are currently performing maintenance on the system. <br/><br/>
					Not all results are available and it may take longer than expected to retreive results.<br/><br/>
					Thank you for your interest.<br/><br/>
					<button class="btn btn-success" ng-click="ack=1">OK</button>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12" ng-show="meta.hasOwnProperty('rows') && meta['available'] > 0">
				<br/>
				Showing {{resultsShowing | number}} of {{meta['available'] | number}} results.<br/>
				<label class="label label-info clickable" ng-click="loadMore()" ng-show="resultsShowing < meta['available']">
					Load {{meta.batchSize}} More
				</label>
			</div>
			<div class="col-md-12" ng-show="meta.hasOwnProperty('rows') && meta['available'] == 0">
				<br/>
				No results found. Please try a broader search term or time period.
			</div>
			<div class="col-md-12" ng-show="errorStatus">
				<br/>
				<div class="alert alert-warning">
					<h4>We Apologize</h4>
					An error has occured while searching. Please try again and send an email to usnewsmap@gtri.gatech.edu if the problem persists.
				</div>
			</div>
		</div>

		<div ng-show="search_started && !loadingStatus">
			<h3>Playback</h3>
			<div class="btn-group btn-group-sm" data-toggle="buttons">
				<label class="btn btn-info" ng-class="{active:markersConstant}">
					<input type="radio" name="searchType" ng-model="markersConstant" data-ng-value="true" autocomplete="off" checked ng-change="setMarkers()" />
					Show Cumulative Hits
				</label>
				<label class="btn btn-info" ng-class="{active:!markersConstant}">
					<input type="radio" name="searchType" ng-model="markersConstant" data-ng-value="false" autocomplete="off" ng-change="setMarkers()" />
					Show Hits Within {{markerYears}}
					<ng-pluralize count="markerYears" when="{'1': 'Year', 'other': 'Years'}"></ng-pluralize>
				</label>
			</div>

			<div class="row">
				<div class="col-md-12 form-inline">
					<div class="row form-inline" ng-show="!markersConstant">
						<div class="col-md-3">
							<label for="markerYears-input">
								Years
							</label>
						</div>
						<div class="col-md-9">
							 <input id="markerYears-input" class="form-control" type="number" name="points" ng-model="markerYears" ng-change="setMarkers()" min="1" max="100" step="1" value="10" />
						</div>
					</div>
					<div class="row form-inline" style="margin-top:5px;">
						<div class="col-md-3">
							<label for="playback_date">
								Playback Date
						</label>
						</div>
						<div class="col-md-9">
							<input type="date" ng-model="rangeDate" min="{{startDate}}" max="{{endDate}}" ng-change="updateRange()" class="form-control" id="playback_date" />
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 form-inline">
					<input type="range" min="{{startDate.getTime()}}" max="{{endDate.getTime()}}" ng-model="range" ng-mousedown="turnOn()" ng-mouseup="turnOn()" ng-change="filter()" step="31536000000" />
					<button ng-hide="isPlaying" ng-click="play()" class="form-control">Play</button>
					<button ng-show="isPlaying" ng-click="play()" class="form-control">Pause</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Map -->

	<div class="row">
		<leaflet maxbounds="maxbounds" tiles="tiles"  markers="markers" event-broadcast="events" center="center" width="100%" height="85%"></leaflet>
	</div>

	<div class="row" ng-cloak>
		<div class="col-md-12" ng-show="timelineEvents.length > 0">
			<h3>Timeline of Results</h3>
			<horizontal-timeline
				start-date="{{startDate.toLocaleDateString()}}"
				end-date="{{endDate.toLocaleDateString()}}"
				events="timelineEvents">
			</horizontal-timeline>
		</div>
	</div>
	<div class="row" ng-cloak ng-show="selectedCity != false">
		<div class="col-md-12">
			<h4>{{selectedCity}}</h4>
			<ul>
				<li ng-repeat="e in allMarkers[selectedCity]">
					<a href="http://chroniclingamerica.loc.gov/lccn/{{e.seq_num}}/{{e.date}}/{{e.ed}}/{{e.seq}}.pdf" target="_blank" ng-click="clickedPaper(e)">
						{{e.date}} &mdash; {{newspapers[e.seq_num].name}}
					</a>
				</li>
			</ul>
		</div>
	</div>
	<footer>
		<div class="col-md-offset-3 col-lg-3 col-md-3" style="height:100px;">
			<a href="http://www.gtri.gatech.edu/icl" target="_blank">
				<img src="images/GTRI_Logo.png" class="img-responsive" />
			</a>
		</div>
		<div class="col-lg-3 col-md-3 text-center">
			<a href="http://www.ehistory.org/" target="_blank">
				<img src="images/eHistory.png" class="img-responsive" />
			</a>
		</div>
	</footer>

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-41089209-6', 'auto');
		ga('send', 'pageview');
	</script>

  </body>
</html>
